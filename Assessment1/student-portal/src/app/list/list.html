<p-toast></p-toast>
<div class="students-container page-enter">
  <div class="students-header">
    <div class="header-icon-wrapper floating-element">
      <i class="pi pi-users"></i>
    </div>
    <h1>Student Directory</h1>
    <p>Manage and view all registered students in your institution</p>
  </div>

  <div class="stats-section">
    <div class="stat-card glow-on-hover">
      <div class="stat-icon">
        <i class="pi pi-users"></i>
      </div>
      <div class="stat-content">
        <div class="stat-number">{{ students().length }}</div>
        <div class="stat-label">Total Students</div>
      </div>
    </div>
    <div class="stat-card glow-on-hover">
      <div class="stat-icon">
        <i class="pi pi-building"></i>
      </div>
      <div class="stat-content">
        <div class="stat-number">{{ getDepartmentCount() }}</div>
        <div class="stat-label">Departments</div>
      </div>
    </div>
    <div class="stat-card glow-on-hover">
      <div class="stat-icon">
        <i class="pi pi-chart-line"></i>
      </div>
      <div class="stat-content">
        <div class="stat-number">{{ getAverageAge() }}</div>
        <div class="stat-label">Average Age</div>
      </div>
    </div>
  </div>

  <p-card class="table-card glow-on-hover">
    <ng-template pTemplate="header">
      <div class="card-header">
        <i class="pi pi-table"></i>
        <div>
          <h2>Registered Students</h2>
          <p>Click on any row to view and edit student details</p>
        </div>
      </div>
    </ng-template>
    
    <p-table 
      [value]="students()" 
      selectionMode="single" 
      (onRowSelect)="onRowSelect($event)" 
      [tableStyle]="{'min-width': '50rem'}"
      class="premium-table">
      <ng-template pTemplate="header">
        <tr>
          <th><i class="pi pi-user"></i> Name</th>
          <th><i class="pi pi-envelope"></i> Email</th>
          <th><i class="pi pi-calendar"></i> Age</th>
          <th><i class="pi pi-building"></i> Department</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-student let-i="rowIndex">
        <tr [pSelectableRow]="student" class="table-row" [style.animation-delay]="i * 0.1 + 's'">
          <td>
            <div class="student-info">
              <div class="student-avatar">{{ student.name.charAt(0).toUpperCase() }}</div>
              <span class="student-name">{{ student.name }}</span>
            </div>
          </td>
          <td class="email-cell">{{ student.email }}</td>
          <td>
            <span class="age-badge">{{ student.age }} years</span>
          </td>
          <td>
            <span class="department-badge">{{ student.department }}</span>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="4" class="empty-state">
            <div class="empty-content">
              <i class="pi pi-users empty-icon"></i>
              <h3>No Students Registered</h3>
              <p>Start building your student directory by registering the first student</p>
              <p-button 
                label="Register First Student" 
                icon="pi pi-user-plus" 
                routerLink="/register"
                class="glow-on-hover">
              </p-button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>

<p-dialog 
  header="Edit Student Profile" 
  [modal]="true" 
  [(visible)]="visible" 
  [style]="{width: '600px'}"
  class="premium-dialog">
  <ng-template pTemplate="header">
    <div class="dialog-header">
      <i class="pi pi-user-edit"></i>
      <div>
        <h3>Edit Student Profile</h3>
        <p>Update student information</p>
      </div>
    </div>
  </ng-template>
  
  <form [formGroup]="editForm">
    <div class="form-grid">
      <div class="field">
        <label for="editName">
          <i class="pi pi-user"></i>
          Full Name *
        </label>
        <input pInputText id="editName" formControlName="name" class="premium-input" />
        <small class="error">{{ getFieldError('name') }}</small>
      </div>

      <div class="field">
        <label for="editEmail">
          <i class="pi pi-envelope"></i>
          Email Address *
        </label>
        <input pInputText id="editEmail" formControlName="email" class="premium-input" />
        <small class="error">{{ getFieldError('email') }}</small>
      </div>

      <div class="field">
        <label for="editAge">
          <i class="pi pi-calendar"></i>
          Age *
        </label>
        <input pInputText id="editAge" type="number" formControlName="age" class="premium-input" />
        <small class="error">{{ getFieldError('age') }}</small>
      </div>

      <div class="field">
        <label for="editDepartment">
          <i class="pi pi-building"></i>
          Department *
        </label>
        <p-select id="editDepartment" formControlName="department" [options]="departments" class="premium-select"></p-select>
        <small class="error">{{ getFieldError('department') }}</small>
      </div>
    </div>
  </form>
  
  <ng-template pTemplate="footer">
    <div class="dialog-actions">
      <p-button 
        label="Cancel" 
        severity="secondary" 
        (onClick)="onCancel()"
        class="glow-on-hover">
      </p-button>
      <p-button 
        label="Save Changes" 
        icon="pi pi-check" 
        (onClick)="onSave()" 
        [disabled]="editForm.invalid"
        class="glow-on-hover">
      </p-button>
    </div>
  </ng-template>
</p-dialog>